<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Calculadora Hospital Santa Marcelina</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alice&display=swap');

        /* Estilos Gerais e Estrutura */
        :root {
            --hospital-primary: #1A4A7F; /* Dark Blue from logo */
            --hospital-secondary: #3B8BCB; /* Medium Blue from logo */
            --hospital-light: #7CBCE6; /* Light Blue from logo */
            --hospital-very-light: #ADDDF6; /* Very Light Blue from logo */
            --hospital-accent: #FFC107; /* Existing accent, can be kept or changed */
            --hospital-background: #f0f4f8;
            --hospital-card-background: #ffffff;
            --hospital-text-on-dark: #ffffff;
            --hospital-text-on-light: #333333;
            --hospital-danger: #dc3545;
            --hospital-success: #28a745;
            --hospital-button-gray-bg: #e9ecef;
            --hospital-button-gray-text: #495057;
            --hospital-button-gray-border: #ced4da;
        }

        * { box-sizing: border-box; }

        html, body {
            height: auto;
            overflow: auto;
            scroll-behavior: smooth;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            background-color: var(--hospital-background); /* Cor de fundo principal, ficará atrás da imagem com opacidade */
            /* A imagem de background original foi movida para o pseudo-elemento ::before para controle de opacidade */
            font-size: 14px;
            min-height: 100vh;
            color: var(--hospital-text-on-light);
            /* Opcional: position: relative; pode ser útil em alguns cenários de empilhamento complexos. */
            /* Opcional: overflow-x: hidden; para prevenir barras de rolagem horizontais inesperadas. */
        }

        /* MODIFICAÇÃO: Pseudo-elemento para a imagem de background "Logo" com opacidade */
        body::before {
            content: '';
            position: fixed; /* Faz com que a imagem de fundo cubra toda a área visível e permaneça fixa durante a rolagem */
            top: 0;
            left: 0;
            right: 0; /* Garante cobertura total */
            bottom: 0; /* Garante cobertura total */
            background-image: url('Logo.png'); /* Caminho para sua imagem "Logo" */
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            opacity: 0.15; /* <<< AJUSTE A OPACIDADE AQUI (0.0 = transparente, 1.0 = opaco). Ex: 0.15 para 15% */
            z-index: -1; /* Coloca o pseudo-elemento atrás de todo o conteúdo do body */
            pointer-events: none; /* Garante que o pseudo-elemento não capture eventos do mouse */
        }

        .site-header {
            /* MODIFICAÇÃO: Cor do header */
            background-color: #00a1d4; /* Mantido o header com sua própria cor de fundo sólida por cima da imagem do body */
            color: var(--hospital-text-on-dark);
            padding: 10px 15px;
            display: flex;
            align-items: center; /* Ensures logo and title are vertically aligned */
            justify-content: center; /* Added to center logo and title block */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative; /* Para garantir que o header fique acima do pseudo-elemento body::before */
            z-index: 1; /* Para garantir que o header fique acima do pseudo-elemento body::before */
        }
        .site-header img {
            height: 32px; /* Default height, will be adjusted for mobile */
            margin-right: 12px; /* Default margin */
        }
        .site-header h1 {
            font-size: 1.4em; /* Default font size */
            margin: 0;
            font-weight: 500;
            white-space: nowrap; /* Try to keep title on one line */
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center; /* Added to center text within h1 if it's wider */
            /* MODIFICAÇÃO: Fonte do título */
            font-family: 'Alice', sans-serif;
        }

        /* --- LAYOUT GRID (4 COLUNAS) PARA MEDICAMENTOS E RESUMO --- */
        .container {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            align-items: stretch; /* Changed from start to stretch for consistent card heights if possible */
            position: relative; /* Para garantir que o container fique acima do pseudo-elemento body::before */
            z-index: 0; /* Ou qualquer valor >= 0, mas menor que o z-index de elementos que devem sobrepor, como modais */
        }

        /* --- ESTILO DOS CARDS DE MEDICAMENTO --- */
        .item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--hospital-card-background);
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            gap: 6px;
            position: relative;
            width: 100%;
            justify-content: space-between;
            min-height: 185px;
        }
        .item-wrapper { /* Used for Sinkalm */
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%; /* Allow wrapper to fill grid cell if align-items: stretch is on container */
            background-color: var(--hospital-card-background);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 8px;
        }
        .item-wrapper > .item { /* Item inside Sinkalm wrapper */
            padding: 0;
            box-shadow: none;
            min-height: auto;
            background-color: transparent;
            margin-bottom: 0;
            flex-grow: 1; /* Allow the item part to take available space */
        }
         .item-wrapper .inline-preset-box {
            flex-shrink: 0; /* Prevent this box from shrinking too much */
        }


        .item-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 5px;
        }
         .item-top-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }


        .item-name {
            font-weight: 600;
            font-size: 11px;
            text-align: left;
            flex-grow: 1;
            margin-right: 5px;
            word-break: break-word;
        }

        .item-image {
            width: 60%; /* Adjusted for slightly larger image */
            max-width: 75px; /* Adjusted max-width */
            height: auto;
            aspect-ratio: 1 / 1;
            object-fit: contain;
            cursor: pointer;
            margin-top: 5px; /* Adjusted margin */
            margin-bottom: 5px; /* Adjusted margin */
            transition: transform 0.18s cubic-bezier(0.34, 1.56, 0.64, 1);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .item-image:active {
            transform: scale(0.90);
            transition-duration: 0.1s;
        }

        /* --- CONTROLES +/- e INPUT --- */
        .controls {
            display: flex;
            gap: 5px;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: auto; /* Pushes controls to bottom */
        }

        input[type="number"] {
            width: 40px; padding: 4px; font-size: 13px; text-align: center; border: 1px solid #ccc;
            border-radius: 4px; height: 28px; -moz-appearance: textfield; appearance: textfield;
            color: var(--hospital-text-on-light);
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        button {
            padding: 6px 10px; font-size: 12px; font-weight: 500; cursor: pointer;
            border: 1px solid var(--hospital-button-gray-border); background-color: var(--hospital-button-gray-bg);
            color: var(--hospital-button-gray-text); border-radius: 5px;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
            line-height: 1.2; min-height: 30px; display: inline-flex; align-items: center;
            justify-content: center; white-space: nowrap;
        }
        button:hover { background-color: #e0e0e0; border-color: #bbb; }
        button:active { box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); transform: scale(0.98); }

        .controls button { /* +/- buttons in item card */
            width: 28px; height: 28px; padding: 0; font-size: 15px; flex-shrink: 0;
        }
        .decrement-max-button {
            background-color: var(--hospital-danger); color: var(--hospital-text-on-dark); border: none;
            padding: 0; width: 24px; height: 24px; font-size: 14px; border-radius: 4px; flex-shrink: 0;
        }
        .decrement-max-button:hover { background-color: #c82333; }


        .max-button {
            background-color: var(--hospital-secondary); color: var(--hospital-text-on-dark); border: none;
            padding: 4px 10px; font-size: 10px; height: 24px; flex-shrink: 0; border-radius: 4px;
        }
        .max-button:hover { background-color: var(--hospital-primary); }

        /* --- CAIXA DE RESUMO/TOTAL --- */
        .total-summary-box {
            background-color: var(--hospital-card-background); border-radius: 8px; padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column;
            align-items: stretch; gap: 6px; height: 100%; /* Allow to stretch */
            min-height: 185px; /* Match item height */
        }

        .total-summary-box .total-box-main {
            font-size: clamp(18px, 4vw, 22px); font-weight: bold; color: var(--hospital-success);
            text-align: center; padding: 8px 5px; background-color: #eaf7ec; border-radius: 6px;
            display: flex; justify-content: center; align-items: baseline; gap: 0.3em;
        }
        .total-summary-box .total-box-main span { display: inline; }

        .total-summary-box .total-breakdown {
            font-size: 11px; color: #454545; padding: 4px 0px; /* margin: 2px 0; Removed, gap handles it */
            line-height: 1.5; text-align: center; min-height: 1.5em;
        }
        #desconto-aplicado-info { font-weight: 500; }

        .total-summary-box .checkbox-group {
            display: flex; flex-direction: column; align-items: flex-start; gap: 4px; /* margin-bottom: 6px; Removed, gap handles it */
        }
        .total-summary-box .checkbox-item {
            font-size: 12px; display: flex; align-items: center; gap: 5px; cursor: pointer; padding: 2px 0; width: 100%;
        }
        .total-summary-box input[type="checkbox"] {
            width: 16px; height: 16px; accent-color: var(--hospital-secondary); cursor: pointer; margin-right: 3px; flex-shrink: 0;
        }
        .total-summary-box .reset-button {
            font-size: 12px; font-weight: bold; background-color: var(--hospital-danger); color: var(--hospital-text-on-dark);
            border-radius: 5px; padding: 6px 10px; border: none; cursor: pointer;
            transition: background-color 0.2s ease; width: 100%; text-align: center;
            /* margin-top: auto; Removed */
            /* margin-bottom: 4px; Removed, gap handles it */
        }
        .total-summary-box .reset-button:hover { background-color: #c82333; }

        .total-summary-box .card-extra-buttons-container {
            display: flex; gap: 6px; /* margin-top: 4px; Removed, gap handles it */
            width: 100%;
        }
        .total-summary-box .card-extra-buttons-container button {
            flex: 1; padding: 6px 4px; font-size: 11px; min-width: 0;
        }

        .bottom-section { /* Section below the main grid */
            background: var(--hospital-card-background); padding: 10px 15px; margin: 10px; margin-top: 5px;
            border-top: 1px solid #e0e0e0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative; /* Para garantir que esta seção fique acima do pseudo-elemento body::before */
            z-index: 0;
        }
        .button-group {
            display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; align-items: center;
        }
        .button-group:last-child { margin-bottom: 0; }

        .size-filter-button { /* For Tudo, P, M, G, GG (geral, se houver fora do Sinkalm) */
            background-color: var(--hospital-button-gray-bg); color: var(--hospital-button-gray-text);
            border: 1px solid var(--hospital-button-gray-border); padding: 6px 12px; font-size: 13px; min-width: 45px;
        }
        .size-filter-button:hover {
            background-color: var(--hospital-light); color: var(--hospital-primary); border-color: var(--hospital-secondary);
        }
        .size-filter-button.active {
            background-color: var(--hospital-secondary); color: var(--hospital-text-on-dark);
            border-color: var(--hospital-primary); font-weight: bold; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
        }

        .extra-toggle-button {
            background-color: var(--hospital-very-light); color: var(--hospital-primary); border: 1px solid var(--hospital-light);
        }
        .extra-toggle-button:hover { background-color: var(--hospital-light); }
        .extra-toggle-button.active {
            background-color: var(--hospital-secondary); color: var(--hospital-text-on-dark);
            border-color: var(--hospital-primary); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); font-weight: bold;
        }

        .info-buttons { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; justify-content: center; }
        .info-buttons button {
            flex-grow: 1; background-color: var(--hospital-accent); color: var(--hospital-text-on-light);
            border: none; font-size: 13px; padding: 10px 8px; min-width: 100px;
        }
        .info-buttons button:hover { background-color: #e0a800; }
        #anotacoesButton { background-color: #6c757d; color: white; }
        #anotacoesButton:hover { background-color: #5a6268; }
        #gessoInfoButton {
            background-color: var(--hospital-very-light); color: var(--hospital-primary); border: 1px solid var(--hospital-light);
        }
        #gessoInfoButton:hover { background-color: var(--hospital-light); }

        .toggle-list, #anotacoesBox {
            display: none; background: #f8f9fa; padding: 15px; border-radius: 8px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05); margin-top: 10px; border: 1px solid #dee2e6;
        }
        .toggle-list ul { list-style: none; padding: 0; margin: 0; }
        .toggle-list li { margin-bottom: 8px; font-size: 13px; color: #343a40; line-height: 1.5; }
        .toggle-list li:last-child { margin-bottom: 0; }
        .toggle-list b { color: var(--hospital-primary); font-weight: 600; }
        .toggle-list .dosage { font-size: 11px; color: #6c757d; margin-left: 5px; }
        .toggle-list h4 {
            margin-top: 10px; margin-bottom: 5px; font-size: 14px; color: var(--hospital-primary);
            border-bottom: 1px solid var(--hospital-light); padding-bottom: 3px;
        }
        .toggle-list h4:first-of-type { margin-top: 0; }
        #duvidasFrequentesList li, #gessoInfoList li { margin-left: 10px; font-size: 12px; color: #495057; }
        #gessoInfoList ul, #duvidasFrequentesList ul { padding-left: 15px; list-style: disc; margin-bottom: 10px; margin-top: 4px; }
        #gessoInfoList li, #duvidasFrequentesList li { margin-bottom: 6px; }
        #anotacoesArea {
            width: 100%; min-height: 100px; border: 1px solid #ced4da; border-radius: 4px;
            padding: 10px; font-family: inherit; font-size: 13px; resize: vertical; margin-bottom: 8px;
        }
        .clear-anotacoes-button {
            background-color: var(--hospital-danger); color: white; border: none; padding: 6px 10px;
            font-size: 12px; font-weight: 500; cursor: pointer; border-radius: 5px;
            transition: background-color 0.2s ease; float: right;
        }
        .clear-anotacoes-button:hover { background-color: #c82333; }

        .inline-preset-box { /* Inside Sinkalm card */
            background-color: #e9ecef; border: 1px solid #dee2e6; border-radius: 6px;
            padding: 6px; /* Reduced padding */
            display: flex; flex-direction: column; gap: 5px; /* Reduced gap */
            align-items: stretch;
        }
        .inline-preset-row-1, .inline-preset-row-2 {
            display: flex; flex-wrap: wrap; gap: 5px; /* Reduced gap */
            justify-content: center; align-items: center;
        }
        .inline-preset-box button { flex-grow: 0; flex-shrink: 0; }

        /* MODIFICAÇÃO: Estilo para os botões "Tudo, P, M, G, GG" dentro do card Sinkalm */
        .inline-preset-box .size-filter-button {
            background-color: var(--hospital-very-light); /* Azul bem claro */
            color: var(--hospital-primary); /* Azul escuro para contraste */
            border: 1px solid var(--hospital-light); /* Borda azul clara */
            padding: 6px 8px; /* Ajuste de padding se necessário, herdando o geral ou específico */
            font-size: 11px; /* Ajuste de fonte se necessário */
        }
        .inline-preset-box .size-filter-button:hover {
            background-color: var(--hospital-light); /* Azul claro no hover */
            color: var(--hospital-text-on-dark); /* Texto branco para contraste */
            border-color: var(--hospital-secondary);
        }
        .inline-preset-box .size-filter-button.active {
            background-color: var(--hospital-secondary); /* Azul médio quando ativo (mantém o estilo original de .active) */
            color: var(--hospital-text-on-dark); /* Texto branco (mantém o estilo original de .active) */
            border-color: var(--hospital-primary); /* Borda azul escura (mantém o estilo original de .active) */
            font-weight: bold;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.15);
        }


        .inline-preset-row-2 button:nth-child(1) { /* 10x10 button */
            background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; padding: 6px 8px; /* Reduced padding */
        }
        .inline-preset-row-2 button:nth-child(1):hover { background-color: #ffeeba; }
        .x10-counter { font-size: 0.85em; margin-left: 5px; color: #6c757d; font-weight: normal; display: inline-block; }

        .inline-preset-row-2 button:nth-child(2) { /* Minus button for 10x10 */
            background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
            width: 30px; height: 30px; /* Slightly smaller */
            padding: 0; font-size: 16px; /* Slightly smaller */
            font-weight: bold;
        }
        .inline-preset-row-2 button:nth-child(2):hover { background-color: #f5c6cb; }

        .scroll-down-button-inline {
            background-color: var(--hospital-success); color: white; border: 1px solid #1e7e34;
            width: 30px; height: 30px; /* Slightly smaller */
            padding: 0; font-size: 18px; /* Slightly smaller */
            line-height: 30px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-left: 2px;
        }
        .scroll-down-button-inline:hover { background-color: #218838; border-color: #1c6c2e; }
        .scroll-down-button-inline:active { background-color: #1e7e34; transform: scale(0.95); }


        @media (max-width: 992px) {
            .container { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            .site-header img { height: 28px; margin-right: 10px;}
            .site-header h1 { font-size: 1.15em; }
            .container { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }

            .item, .total-summary-box, .item-wrapper { min-height: 165px; } /* Reduced min-height */
            .item-wrapper { padding: 6px; } /* Ensure wrapper padding doesn't add too much */
            .item-wrapper > .item { padding: 4px 0 0 0; } /* Reduce padding inside wrapped item */


            .inline-preset-box { padding: 5px; gap: 4px; }
            /* Os estilos específicos para .inline-preset-box .size-filter-button acima já cuidam da cor.
             Abaixo, mantemos os ajustes de tamanho responsivos para esses botões. */
            .inline-preset-box .size-filter-button {
                 padding: 5px 4px; font-size: 10px; min-width: 30px; flex-grow: 1; flex-basis: 0; height: 28px;
            }
            .inline-preset-row-1 { gap: 4px; flex-wrap: nowrap; } /* Mantido para estrutura */

            .inline-preset-row-2 button:nth-child(2),
            .scroll-down-button-inline { width: 30px; height: 30px; font-size: 15px; line-height: 30px; }
            .scroll-down-button-inline { font-size: 17px; }


            .decrement-max-button { width: 22px; height: 22px; font-size: 12px;}
            .max-button { padding: 4px 8px; height: 22px; font-size: 9px; }
            .total-summary-box { gap: 5px; }
            .total-summary-box .total-breakdown { font-size: 10px; padding: 3px 0; /* margin: 1px 0; */}
            .total-summary-box .checkbox-group { gap: 3px; /* margin-bottom: 4px; */ }
            .total-summary-box .reset-button { /* margin-top: 3px; margin-bottom: 3px; */ font-size:11px; padding: 5px 8px;}
            .total-summary-box .card-extra-buttons-container { /* margin-top: 3px; */ }
            .total-summary-box .card-extra-buttons-container button { font-size: 10px; padding: 5px 3px; }

            .item-image { max-width: 65px; margin-top: 3px; margin-bottom: 3px;} /* Slightly larger image, balanced margins */
            .item-name {font-size: 10px;}
        }

        @media (max-width: 480px) {
            .site-header {
                padding: 8px 10px; /* Adjust padding */
            }
            .site-header img { height: 24px; margin-right: 8px; } /* Smaller logo */
            .site-header h1 { font-size: 0.95em; } /* Smaller title */

            body { font-size: 12px; } /* Base font smaller */
            .container { grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 8px; }

            .item, .total-summary-box { min-height: 150px; padding: 5px; gap: 2px; }
            .item-wrapper { min-height: auto; padding: 5px; gap: 3px; }
            .item-wrapper > .item { padding: 0; gap: 2px;}


            .total-summary-box { padding: 6px; gap: 4px; }
            .total-summary-box .total-box-main { font-size: 15px; padding: 5px 3px; }
            .total-summary-box .total-breakdown { font-size: 9px; padding: 2px 0px; /* margin: 1px 0; */}
            .total-summary-box .checkbox-group { gap: 2px; /* margin-bottom: 3px; */}
            .total-summary-box .checkbox-item { font-size: 10px; gap: 3px;}
            .total-summary-box input[type="checkbox"] { width: 14px; height: 14px; margin-right: 2px;}
            .total-summary-box .reset-button { font-size: 10px; padding: 5px 6px; /* margin-top: auto; margin-bottom: 2px; */}
            .total-summary-box .card-extra-buttons-container { gap: 3px; /* margin-top: 2px; */ }
            .total-summary-box .card-extra-buttons-container button { font-size: 9px; padding: 4px 2px; min-height: 26px;}


            .item-name { font-size: 9px; line-height: 1.1; margin-bottom: 1px; margin-right: 2px; }
            .item-top { margin-bottom: 2px; }
            .decrement-max-button { width: 18px; height: 18px; font-size: 9px;}
            .max-button { height: 20px; padding: 2px 5px; font-size: 8px; line-height: 1; }
            .item-image { width: 55%; max-width: 55px; margin-top: 2px; margin-bottom: 2px; } /* Increased size, balanced margins */
            .controls { gap: 1px; }
            input[type="number"] { width: 30px; height: 22px; font-size: 10px; padding: 2px; }
            .controls button { width: 22px; height: 22px; font-size: 12px; }

            .inline-preset-box { padding: 4px; gap: 3px; }
            .inline-preset-row-1 { gap: 2px; flex-wrap: nowrap; }
            .inline-preset-row-2 { gap: 4px; }

            /* Os estilos específicos para .inline-preset-box .size-filter-button acima já cuidam da cor.
             Abaixo, mantemos os ajustes de tamanho responsivos para esses botões. */
            .inline-preset-box .size-filter-button {
                 padding: 3px 1px; font-size: 9px; min-width: auto;
                 flex-grow: 1; flex-basis: 0; line-height: 1.1; height: 26px;
            }
            .inline-preset-box button { /* Outros botões dentro do inline-preset-box, se houver */
                 font-size: 9px; padding: 4px 6px; min-height: 28px;
            }
             .inline-preset-row-2 button:nth-child(1) { /* 10x10 button */
                 padding: 4px 6px;
            }
            .inline-preset-row-2 button:nth-child(2), /* Minus for 10x10 */
            .scroll-down-button-inline { width: 28px; height: 28px; font-size: 13px; line-height: 28px; }
            .scroll-down-button-inline { font-size: 15px; }

            .bottom-section { padding: 6px 8px; margin: 5px; }
            .info-buttons { gap: 4px; margin-top: 6px; }
            .info-buttons button { min-width: 50px; padding: 6px 3px; font-size: 9px; }
            .button-group { gap: 4px; margin-bottom: 6px; }
            .extra-toggle-button { padding: 3px 5px; font-size: 9px; min-height: 24px; }
            .toggle-list, #anotacoesBox { padding: 8px; margin-top: 6px; }
            .toggle-list li, #duvidasFrequentesList li, #gessoInfoList li { font-size: 10px; }
            .toggle-list h4 { font-size: 11px; }
            #anotacoesArea { font-size: 11px; min-height: 60px; }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <img src="Logo Hospital Santa Marcelina.png" alt="Logo Hospital Santa Marcelina"> <h1>Hospital Santa Marcelina - Calculadora</h1>
    </header>

    <div class="container" id="items">
    </div>

    <div class="bottom-section">
        <div class="button-group extra-buttons" id="extraButtonsContainer">
            <button class="extra-toggle-button" data-name="Resgate Norte" data-value="1500" onclick="toggleExtra(this)">Resgate Norte</button>
            <button class="extra-toggle-button" data-name="Exames" data-value="3000" onclick="toggleExtra(this)">Exames</button>
            <button class="extra-toggle-button" data-name="Ressonância" data-value="5000" onclick="toggleExtra(this)">Ressonância</button>
        </div>

        <div class="button-group info-buttons">
            <button id="dipironaButton" onclick="toggleDipironaList()">S/Dipirona</button>
            <button id="anotacoesButton" onclick="toggleAnotacoes()">Anotações</button>
            <button id="duvidasFrequentesButton" onclick="toggleDuvidasFrequentesList()">Dúvidas Frequentes</button>
            <button id="gessoInfoButton" onclick="toggleGessoInfoList()">Gesso Info</button>
        </div>

        <div class="toggle-list" id="dipironaList">
            <ul>
                <li><b>Ibuprofeno</b> <span class="dosage">(Ex: 400mg ou 600mg)</span> (anti-inflamatório)</li>
                <li><b>Cetoprofeno</b> <span class="dosage">(Ex: 50mg ou 100mg)</span> (anti-inflamatório)</li>
                <li><b>Paracetamol</b> <span class="dosage">(Ex: 500mg ou 750mg)</span> (analgésico, antitérmico)</li>
                <li><b>Diclofenaco</b> <span class="dosage">(Ex: 50mg)</span> (anti-inflamatório, dor muscular)</li>
                <li><b>Flurbiprofeno</b> <span class="dosage">(Ex: 50mg ou 100mg)</span> (anti-inflamatório, dor muscular)</li>
                <li><b>Clorfeniramina</b> <span class="dosage">(Ex: 4mg)</span> (antialérgico)</li>
            </ul>
        </div>
        <div id="anotacoesBox">
            <textarea id="anotacoesArea" placeholder="Digite suas anotações aqui..."></textarea>
            <button id="clearAnotacoesButton" class="clear-anotacoes-button">Apagar Tudo</button>
        </div>
        <div class="toggle-list" id="duvidasFrequentesList">
            <ul>
                <li>RÁDIO 192 (Esteja sempre conectado enquanto estiver em serviço)</li>
                <li>Preço de deslocamento Sul (1000)</li>
                <li>Preço de descolocamento Norte (1500)</li>
                <li>Cobrar o tratamento apenas de presos no presídio</li>
                <li>Não dê tratamento fora do hospital, apenas em ações grandes com a polícia (nunca para bandidos)</li>
                <li>Em caso de atendimento ou coleta de sangue fora do Hospital, abra as portas da ambulância e peça para que as pessoas se sentem ali, e faça o procedimento.</li>
            </ul>
        </div>
        <div class="toggle-list" id="gessoInfoList">
            <h4>Masculino:</h4>
            <ul>
                <li><b>Braço Esquerdo:</b> Camisa 223</li>
                <li><b>Braço Direito:</b> Colete 64</li>
                <li><b>Perna Esquerda:</b> Adesivo 245</li>
                <li><b>Perna Direita:</b> Adesivo 246</li>
                <li><b>Parte inferior:</b> Calça 56</li>
                <li><b>Tronco:</b> Jaqueta 649</li>
            </ul>
            <h4>Feminino:</h4>
            <ul>
                <li><b>Braço Esquerdo:</b> Colete 64</li>
                <li><b>Braço Direito:</b> Camisa 269</li>
                <li><b>Perna Esquerda:</b> Adesivo 261</li>
                <li><b>Perna Direita:</b> Adesivo 262 (quando só a perna esquerda estiver fraturada)</li>
                <li><b>Perna Direita:</b> sapato 166</li>
                <li><b>Parte inferior:</b> Calça 57</li>
                <li><b>Tronco:</b> Jaqueta 724</li>
            </ul>
        </div>
    </div>

    <script>
        const produtosBase = [
            { nome: 'Adrenalina', precoBase: 12000, precoCNPJ: 9500, precoPMArcanjo: 9000, precoConvenio: 9500, maximo: 3, imagem: 'adrenalina.png' },
            { nome: 'Analgésico', precoBase: 600,   precoCNPJ: 500, precoPMArcanjo: 450, precoConvenio: 500, maximo: 10, imagem: 'analgesico.png' },
            { nome: 'Atadura',    precoBase: 300,   precoCNPJ: 250, precoPMArcanjo: 200, precoConvenio: 250, maximo: 10, imagem: 'atadura.png' },
            { nome: 'Bandagem',   precoBase: 500,   precoCNPJ: 400, precoPMArcanjo: 350, precoConvenio: 400, maximo: 5,  imagem: 'bandagem.png' },
            { nome: 'Medkit',     precoBase: 2500,  precoCNPJ: 2000, precoPMArcanjo: 1500, precoConvenio: 2000, maximo: 2,  imagem: 'medkit.png' },
            { nome: 'Ritmoneury', precoBase: 800,   precoCNPJ: 600, precoPMArcanjo: 600, precoConvenio: 600, maximo: 5,  imagem: 'ritmoneury.png' },
            { nome: 'Sinkalm',    precoBase: 800,   precoCNPJ: 600, precoPMArcanjo: 500, precoConvenio: 600, maximo: 5,  imagem: 'sinkalmy.png' },
        ];

        const quantidades = {};
        const extraItemsState = {
            "Raio-X": { value: 2500, active: false, precoConvenio: 2000 },
            "Gesso": { value: 2500, active: false, precoConvenio: 2000 },
            "Queimadura": { value: 1600, active: false }
        };
        let x10count = 0;

        const ABSOLUTE_ITEM_CAP = 99;
        const itemsContainer = document.getElementById('items');
        const dipironaList = document.getElementById('dipironaList');
        const duvidasFrequentesList = document.getElementById('duvidasFrequentesList'); // Alterado
        const anotacoesBox = document.getElementById('anotacoesBox');
        const anotacoesArea = document.getElementById('anotacoesArea');
        const clearAnotacoesButton = document.getElementById('clearAnotacoesButton');
        const gessoInfoList = document.getElementById('gessoInfoList');

        let totalValueSpan, descontoAplicadoSpan;
        let atendimentoCheckbox, pmArcanjoCheckbox, cnpjCheckbox, convenioCheckbox, resetButtonElement;

        let inactivityTimer;
        const INACTIVITY_TIMEOUT = 300000; // 5 minutos (300000 milissegundos)

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                resetar();
            }, INACTIVITY_TIMEOUT);
        }

        function getCurrentPrice(produto) {
            const isCnpjChecked = cnpjCheckbox && cnpjCheckbox.checked;
            const isPmArcanjoChecked = pmArcanjoCheckbox && pmArcanjoCheckbox.checked;
            const isConvenioChecked = convenioCheckbox && convenioCheckbox.checked;

            if (isConvenioChecked && produto.precoConvenio !== null) { return produto.precoConvenio; }
            if (isCnpjChecked && produto.precoCNPJ !== null) { return produto.precoCNPJ; }
            if (isPmArcanjoChecked && produto.precoPMArcanjo !== null) { return produto.precoPMArcanjo; }
            return produto.precoBase;
        }

        function updateItemPriceDisplay() {
            const itemElements = itemsContainer.querySelectorAll('.item');
            itemElements.forEach((itemElement) => {
                const index = parseInt(itemElement.dataset.index, 10);
                if (isNaN(index) || index >= produtosBase.length) return;
                const produto = produtosBase[index];
                const nameElement = itemElement.querySelector('.item-name');
                if (nameElement && produto) {
                    const currentPrice = getCurrentPrice(produto);
                    nameElement.textContent = `${produto.nome} (R$${currentPrice.toLocaleString('pt-BR')})`;
                }
            });
        }

        function updateX10Display() {
            const sinkalmWrapper = document.querySelector('.item-wrapper[data-contains-sinkalm="true"]');
            const inlineSpan = sinkalmWrapper?.querySelector('#inline-x10count');
            if (inlineSpan) {
                inlineSpan.textContent = `(${x10count}x)`;
            }
        }

        function atualizarTotal() {
            let subtotalItens = 0;
            produtosBase.forEach((produto, index) => {
                const qtd = quantidades[index] || 0;
                const precoUnit = getCurrentPrice(produto);
                subtotalItens += precoUnit * qtd;
            });

            let totalExtras = 0;
            const isConvenioChecked = convenioCheckbox && convenioCheckbox.checked;
            for (const name in extraItemsState) {
                if (extraItemsState[name]?.active) {
                    if (isConvenioChecked && extraItemsState[name].precoConvenio !== undefined) {
                        totalExtras += extraItemsState[name].precoConvenio;
                    } else {
                        totalExtras += extraItemsState[name].value;
                    }
                }
            }

            const valorAtendimentoBase = 2000;
            const valorAtendimentoConvenio = 1500;
            const valorAtendimento = (atendimentoCheckbox && atendimentoCheckbox.checked)
                                       ? (isConvenioChecked ? valorAtendimentoConvenio : valorAtendimentoBase)
                                       : 0;

            const valor10x10Total = x10count * 5000;
            const totalFinal = subtotalItens + totalExtras + valorAtendimento + valor10x10Total;

            if (totalValueSpan) totalValueSpan.textContent = totalFinal.toLocaleString('pt-BR');

            if (descontoAplicadoSpan) {
                if (cnpjCheckbox && cnpjCheckbox.checked) {
                    descontoAplicadoSpan.textContent = "Desconto CNPJ Ativado";
                    descontoAplicadoSpan.style.display = 'block';
                    descontoAplicadoSpan.style.color = 'var(--hospital-success)';
                } else if (pmArcanjoCheckbox && pmArcanjoCheckbox.checked) {
                    descontoAplicadoSpan.textContent = "Desconto PM/Arcanjo Ativado";
                    descontoAplicadoSpan.style.display = 'block';
                    descontoAplicadoSpan.style.color = 'var(--hospital-secondary)';
                } else if (convenioCheckbox && convenioCheckbox.checked) {
                    descontoAplicadoSpan.textContent = "Desconto Convênio Ativado";
                    descontoAplicadoSpan.style.display = 'block';
                    descontoAplicadoSpan.style.color = 'var(--hospital-accent)';
                }
                else {
                    descontoAplicadoSpan.style.display = 'none';
                }
            }
            updateItemPriceDisplay();
        }

        function closeOtherPanels(currentPanelId) {
            [dipironaList, duvidasFrequentesList, anotacoesBox, gessoInfoList].forEach(panel => { // Alterado
                if (panel && panel.id !== currentPanelId) panel.style.display = 'none';
            });
        }
        function toggleDipironaList() { closeOtherPanels('dipironaList'); dipironaList.style.display = dipironaList.style.display === 'block' ? 'none' : 'block'; resetInactivityTimer(); }
        function toggleDuvidasFrequentesList() { closeOtherPanels('duvidasFrequentesList'); duvidasFrequentesList.style.display = duvidasFrequentesList.style.display === 'block' ? 'none' : 'block'; resetInactivityTimer(); } // Alterado
        function toggleAnotacoes() { closeOtherPanels('anotacoesBox'); anotacoesBox.style.display = anotacoesBox.style.display === 'block' ? 'none' : 'block'; resetInactivityTimer(); }
        function toggleGessoInfoList() { closeOtherPanels('gessoInfoList'); gessoInfoList.style.display = gessoInfoList.style.display === 'block' ? 'none' : 'block'; resetInactivityTimer(); }


        function clearAllMedicationQuantities() {
            produtosBase.forEach((produto, index) => {
                quantidades[index] = 0;
                const itemElement = itemsContainer.querySelector(`.item[data-index="${index}"]`);
                const inputElement = itemElement?.querySelector(`input[type="number"]`);
                if (inputElement) inputElement.value = 0;
            });
            x10count = 0;
            updateX10Display();
        }

        function setActiveSizeButton(targetButton, containerSelector = '.inline-preset-box') {
            const controlsBox = targetButton.closest(containerSelector);
            controlsBox?.querySelectorAll('.size-filter-button[data-size]').forEach(btn => {
                btn.classList.remove('active');
            });
            targetButton.classList.add('active');
            const tudoButton = controlsBox?.querySelector('.size-filter-button[data-size="Tudo"]');
            if (targetButton !== tudoButton) {
                tudoButton?.classList.remove('active');
            }
        }

        function aplicarPresetTudo(buttonElement) {
            resetInactivityTimer();
            const isActive = buttonElement.classList.contains('active');
            const sinkalmControls = buttonElement.closest('.inline-preset-box');

            if (isActive) {
                buttonElement.classList.remove('active');
                clearAllMedicationQuantities();
            } else {
                sinkalmControls?.querySelectorAll('.size-filter-button[data-size]').forEach(btn => {
                    btn.classList.remove('active');
                });
                buttonElement.classList.add('active');
                produtosBase.forEach(produto => {
                    setQuant(produto.nome, getMaxUnitValue(produto.nome));
                });
            }
            atualizarTotal();
        }

        function aplicarPresetP(buttonElement) {
            resetInactivityTimer();
            const isActive = buttonElement.classList.contains('active');
            if (isActive) {
                buttonElement.classList.remove('active');
                clearAllMedicationQuantities();
            } else {
                if(buttonElement) setActiveSizeButton(buttonElement);
                setQuant('Atadura', getMaxUnitValue('Atadura')); setQuant('Medkit', getMaxUnitValue('Medkit'));
                setQuant('Bandagem', getMaxUnitValue('Bandagem')); setQuant('Analgésico', 0);
                setQuant('Adrenalina', 0); setQuant('Sinkalm', 0); setQuant('Ritmoneury', 0);
                x10count = 0; updateX10Display();
            }
            atualizarTotal();
        }
        function aplicarPresetM(buttonElement) {
            resetInactivityTimer();
            const isActive = buttonElement.classList.contains('active');
            if (isActive) {
                buttonElement.classList.remove('active');
                clearAllMedicationQuantities();
            } else {
                if(buttonElement) setActiveSizeButton(buttonElement);
                setQuant('Atadura', getMaxUnitValue('Atadura')); setQuant('Medkit', getMaxUnitValue('Medkit'));
                setQuant('Bandagem', getMaxUnitValue('Bandagem')); setQuant('Analgésico', getMaxUnitValue('Analgésico'));
                setQuant('Adrenalina', 0); setQuant('Sinkalm', 0); setQuant('Ritmoneury', 0);
                x10count = 0; updateX10Display();
            }
            atualizarTotal();
        }
        function aplicarPresetG(buttonElement) {
            resetInactivityTimer();
            const isActive = buttonElement.classList.contains('active');
            if (isActive) {
                buttonElement.classList.remove('active');
                clearAllMedicationQuantities();
            } else {
                if(buttonElement) setActiveSizeButton(buttonElement);
                setQuant('Atadura', getMaxUnitValue('Atadura')); setQuant('Medkit', getMaxUnitValue('Medkit'));
                setQuant('Bandagem', getMaxUnitValue('Bandagem')); setQuant('Analgésico', getMaxUnitValue('Analgésico'));
                setQuant('Adrenalina', 1); setQuant('Sinkalm', 0); setQuant('Ritmoneury', 0);
                x10count = 0; updateX10Display();
            }
            atualizarTotal();
        }
        function aplicarPresetGG(buttonElement) {
            resetInactivityTimer();
            const isActive = buttonElement.classList.contains('active');
            if (isActive) {
                buttonElement.classList.remove('active');
                clearAllMedicationQuantities();
            } else {
                if(buttonElement) setActiveSizeButton(buttonElement);
                setQuant('Atadura', getMaxUnitValue('Atadura')); setQuant('Medkit', getMaxUnitValue('Medkit'));
                setQuant('Bandagem', getMaxUnitValue('Bandagem')); setQuant('Analgésico', getMaxUnitValue('Analgésico'));
                setQuant('Adrenalina', getMaxUnitValue('Adrenalina')); setQuant('Sinkalm', 0); setQuant('Ritmoneury', 0);
                x10count = 0; updateX10Display();
            }
            atualizarTotal();
        }

        function toggleExtra(buttonElement) {
            resetInactivityTimer();
            if (!buttonElement?.dataset.name || !buttonElement.dataset.value) return;
            const name = buttonElement.dataset.name;
            const value = parseInt(buttonElement.dataset.value, 10);
            if (isNaN(value)) return;

            // Initialize extraItemsState entry if it doesn't exist, ensure it has `active`
            if (!extraItemsState[name]) {
                extraItemsState[name] = { value: value, active: false };
                // Copy precoConvenio from data-set if it exists, for Raio-X and Gesso
                if (buttonElement.dataset.precoConvenio) {
                    extraItemsState[name].precoConvenio = parseInt(buttonElement.dataset.precoConvenio, 10);
                }
            }

            extraItemsState[name].active = !extraItemsState[name].active;
            buttonElement.classList.toggle('active', extraItemsState[name].active);
            atualizarTotal();
        }

        function add10x10() { x10count++; updateX10Display(); atualizarTotal(); resetInactivityTimer(); }
        function remove10x10() { if (x10count > 0) { x10count--; updateX10Display(); atualizarTotal(); } resetInactivityTimer(); }

        function resetar() {
            clearTimeout(inactivityTimer);
            clearAllMedicationQuantities();

            if (atendimentoCheckbox) atendimentoCheckbox.checked = false;
            if (cnpjCheckbox) cnpjCheckbox.checked = false;
            if (pmArcanjoCheckbox) pmArcanjoCheckbox.checked = false;
            if (convenioCheckbox) convenioCheckbox.checked = false;

            Object.keys(extraItemsState).forEach(name => extraItemsState[name].active = false);
            document.querySelectorAll('.extra-toggle-button.active').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.total-summary-box .extra-toggle-button.active').forEach(btn => btn.classList.remove('active'));


            document.querySelectorAll('.item-wrapper[data-contains-sinkalm="true"] .size-filter-button.active').forEach(btn => {
                btn.classList.remove('active');
            });

            atualizarTotal();
            [dipironaList, duvidasFrequentesList, anotacoesBox, gessoInfoList].forEach(panel => panel.style.display = 'none'); // Alterado
            anotacoesArea.value = '';
            localStorage.removeItem('anotacoesCalculadora');

            const scrollButton = document.getElementById('scrollToggleButton');
            if (scrollButton) scrollButton.innerHTML = '&#8595;';
        }

        function setQuant(nomeProduto, quantidade) {
            const index = produtosBase.findIndex(p => p.nome === nomeProduto);
            if (index !== -1) {
                quantidades[index] = Math.max(0, Math.min(quantidade, ABSOLUTE_ITEM_CAP));

                const itemElement = itemsContainer.querySelector(`.item[data-index="${index}"]`);
                const inputElement = itemElement?.querySelector(`input[type="number"]`);
                if (inputElement) inputElement.value = quantidades[index];
            }
        }

        function changeQuantity(index, delta) {
            resetInactivityTimer();
            const produto = produtosBase[index];
            if (!produto) return;
            const inputElement = itemsContainer.querySelector(`.item[data-index="${index}"] input[type="number"]`);
            if (!inputElement) return;

            let currentQuantity = quantidades[index] || 0;
            let newQuantity = currentQuantity + delta;
            newQuantity = Math.max(0, Math.min(newQuantity, ABSOLUTE_ITEM_CAP));

            quantidades[index] = newQuantity;
            inputElement.value = newQuantity;
            atualizarTotal();
        }

        function handleDirectInput(index, inputElement) {
            resetInactivityTimer();
            const produto = produtosBase[index];
            if (!produto) return;
            let value = parseInt(inputElement.value, 10);
            if (isNaN(value) || value < 0) value = 0;
            value = Math.min(value, ABSOLUTE_ITEM_CAP);
            inputElement.value = value;
            quantidades[index] = value;
            atualizarTotal();
        }

        function setMaxToUnit(index) {
            resetInactivityTimer();
            const produto = produtosBase[index];
            if (!produto) return;

            quantidades[index] = produto.maximo;
            if (quantidades[index] > ABSOLUTE_ITEM_CAP) quantidades[index] = ABSOLUTE_ITEM_CAP;

            const itemElement = itemsContainer.querySelector(`.item[data-index="${index}"]`);
            const inputElement = itemElement?.querySelector(`input[type="number"]`);
            if (inputElement) inputElement.value = quantidades[index];
            atualizarTotal();
        }

        function addImageClickQuantity(index) {
            resetInactivityTimer();
            const produto = produtosBase[index];
            if (!produto) return;

            let currentQuantity = quantidades[index] || 0;
            let newQuantity = currentQuantity + produto.maximo;
            quantidades[index] = Math.min(newQuantity, ABSOLUTE_ITEM_CAP);

            const itemElement = itemsContainer.querySelector(`.item[data-index="${index}"]`);
            const inputElement = itemElement?.querySelector(`input[type="number"]`);
            if (inputElement) inputElement.value = quantidades[index];
            atualizarTotal();
        }

        function decrementMaxUnit(index) {
            resetInactivityTimer();
            const produto = produtosBase[index];
            if (!produto) return;

            let currentQuantity = quantidades[index] || 0;
            let newQuantity = currentQuantity - produto.maximo;
            quantidades[index] = Math.max(0, newQuantity);

            const itemElement = itemsContainer.querySelector(`.item[data-index="${index}"]`);
            const inputElement = itemElement?.querySelector(`input[type="number"]`);
            if (inputElement) inputElement.value = quantidades[index];
            atualizarTotal();
        }

        function getMaxUnitValue(nomeProduto) {
            const produto = produtosBase.find(p => p.nome === nomeProduto);
            return produto ? produto.maximo : 0;
        }

        function createSinkalmSpecificControlsBox() {
            const box = document.createElement('div');
            box.classList.add('inline-preset-box');
            const sizeFilterRow = document.createElement('div');
            sizeFilterRow.classList.add('inline-preset-row-1');
            sizeFilterRow.innerHTML = `
                <button class="size-filter-button" data-size="Tudo" onclick="aplicarPresetTudo(this)">Tudo</button>
                <button class="size-filter-button" data-size="P" onclick="aplicarPresetP(this)">P</button>
                <button class="size-filter-button" data-size="M" onclick="aplicarPresetM(this)">M</button>
                <button class="size-filter-button" data-size="G" onclick="aplicarPresetG(this)">G</button>
                <button class="size-filter-button" data-size="GG" onclick="aplicarPresetGG(this)">GG</button>
            `;
            box.appendChild(sizeFilterRow);
            const actionsRow = document.createElement('div');
            actionsRow.classList.add('inline-preset-row-2');
            actionsRow.innerHTML = `
                <button onclick="add10x10()">10x10 <span id="inline-x10count" class="x10-counter">(0x)</span></button>
                <button onclick="remove10x10()">-</button>
                <button id="scrollToggleButton" class="scroll-down-button-inline" onclick="togglePageScroll()">&#8595;</button>
            `;
            box.appendChild(actionsRow);
            return box;
        }

        function togglePageScroll() {
            resetInactivityTimer();
            const threshold = 10;
            const isAtBottom = (window.innerHeight + Math.ceil(window.scrollY)) >= (document.body.scrollHeight - threshold);
            const scrollButton = document.getElementById('scrollToggleButton');

            if (isAtBottom) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                if (scrollButton) scrollButton.innerHTML = '&#8595;';
            } else {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                if (scrollButton) scrollButton.innerHTML = '&#8593;';
            }
        }

        function criarInterface() {
            itemsContainer.innerHTML = '';
            produtosBase.forEach((produto, index) => {
                const ehSinkalm = produto.nome === 'Sinkalm';
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('item');
                itemDiv.dataset.index = index;
                const currentPrice = getCurrentPrice(produto);
                itemDiv.innerHTML = `
                    <div class="item-top">
                        <span class="item-name">${produto.nome} (R$${currentPrice.toLocaleString('pt-BR')})</span>
                        <div class="item-top-buttons">
                            <button class="decrement-max-button" onclick="decrementMaxUnit(${index})">-</button>
                            <button class="max-button" onclick="setMaxToUnit(${index})">MAX</button>
                        </div>
                    </div>
                    <img class="item-image" src="${produto.imagem}" alt="${produto.nome}" onclick="addImageClickQuantity(${index})">
                    <div class="controls">
                        <button onclick="changeQuantity(${index}, -1)">-</button>
                        <input type="number" value="0" min="0" max="${ABSOLUTE_ITEM_CAP}" onchange="handleDirectInput(${index}, this)" oninput="handleDirectInput(${index}, this)">
                        <button onclick="changeQuantity(${index}, 1)">+</button>
                    </div>
                `;
                if (ehSinkalm) {
                    const itemWrapper = document.createElement('div');
                    itemWrapper.classList.add('item-wrapper');
                    itemWrapper.dataset.containsSinkalm = "true";
                    itemWrapper.appendChild(itemDiv);
                    itemWrapper.appendChild(createSinkalmSpecificControlsBox());
                    itemsContainer.appendChild(itemWrapper);
                } else {
                    itemsContainer.appendChild(itemDiv);
                }
                quantidades[index] = 0;
            });
            createTotalSummaryBox();
            atualizarTotal();
        }

        function createTotalSummaryBox() {
            const summaryBox = document.createElement('div');
            summaryBox.classList.add('total-summary-box');
            summaryBox.innerHTML = `
                <div class="total-box-main">
                    <span>Total: R$</span>
                    <span id="total-value">0</span>
                </div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="atendimentoCheckbox"> + Atendimento (R$ 2000)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="cnpjCheckbox"> Desconto CNPJ
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="pmArcanjoCheckbox"> Desconto PM/Arcanjo
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="convenioCheckbox"> Desconto Convênio
                    </label>
                </div>
                <button id="resetButton" class="reset-button">RESETAR TUDO</button>
                <div class="card-extra-buttons-container">
                    <button class="extra-toggle-button" data-name="Raio-X" data-value="2500" data-preco-convenio="2000" onclick="toggleExtra(this)">Raio-x</button>
                    <button class="extra-toggle-button" data-name="Gesso" data-value="2500" data-preco-convenio="2000" onclick="toggleExtra(this)">Gesso</button>
                    <button class="extra-toggle-button" data-name="Queimadura" data-value="1600" onclick="toggleExtra(this)">Queimadura</button>
                </div>
                <div class="total-breakdown">
                    <div id="desconto-aplicado-info" style="display: none;"></div>
                </div>
            `;
            itemsContainer.appendChild(summaryBox);

            totalValueSpan = document.getElementById('total-value');
            descontoAplicadoSpan = document.getElementById('desconto-aplicado-info');

            atendimentoCheckbox = document.getElementById('atendimentoCheckbox');
            cnpjCheckbox = document.getElementById('cnpjCheckbox');
            pmArcanjoCheckbox = document.getElementById('pmArcanjoCheckbox');
            convenioCheckbox = document.getElementById('convenioCheckbox');
            resetButtonElement = document.getElementById('resetButton');

            atendimentoCheckbox.addEventListener('change', () => { atualizarTotal(); resetInactivityTimer(); });
            cnpjCheckbox.addEventListener('change', () => {
                if (cnpjCheckbox.checked) {
                    if (pmArcanjoCheckbox.checked) pmArcanjoCheckbox.checked = false;
                    if (convenioCheckbox.checked) convenioCheckbox.checked = false;
                }
                atualizarTotal();
                resetInactivityTimer();
            });
            pmArcanjoCheckbox.addEventListener('change', () => {
                if (pmArcanjoCheckbox.checked) {
                    if (cnpjCheckbox.checked) cnpjCheckbox.checked = false;
                    if (convenioCheckbox.checked) convenioCheckbox.checked = false;
                }
                atualizarTotal();
                resetInactivityTimer();
            });
            convenioCheckbox.addEventListener('change', () => {
                if (convenioCheckbox.checked) {
                    if (cnpjCheckbox.checked) cnpjCheckbox.checked = false;
                    if (pmArcanjoCheckbox.checked) pmArcanjoCheckbox.checked = false;
                }
                atualizarTotal();
                resetInactivityTimer();
            });
            resetButtonElement.addEventListener('click', resetar);
        }

        document.addEventListener('DOMContentLoaded', () => {
            criarInterface();
            const savedAnotacoes = localStorage.getItem('anotacoesCalculadora');
            if (savedAnotacoes) anotacoesArea.value = savedAnotacoes;
            anotacoesArea.addEventListener('input', () => {
                localStorage.setItem('anotacoesCalculadora', anotacoesArea.value);
                resetInactivityTimer();
            });
            clearAnotacoesButton.addEventListener('click', () => {
                anotacoesArea.value = '';
                localStorage.removeItem('anotacoesCalculadora');
                resetInactivityTimer();
            });
            resetInactivityTimer();
        });
    </script>
</body>
</html>